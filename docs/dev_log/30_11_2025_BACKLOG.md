# üõ† Project Backlog - 30/11/2025

T√†i li·ªáu n√†y ghi l·∫°i c√°c v·∫•n ƒë·ªÅ c·∫ßn s·ª≠a, n·ª£ k·ªπ thu·∫≠t (technical debt) c·∫ßn tr·∫£ v√† c√°c t√≠nh nƒÉng d·ª± ki·∫øn trong t∆∞∆°ng lai.

**Writer:** Nguyen Bao Duy

**Priority Guide:**

- **P0**: Critical - Must fix immediately (breaks functionality/UX)
- **P1**: High - Important for next sprint
- **P2**: Medium - Improvements, nice to have
- **P3**: Low - Polish, long-term improvements

**Effort Estimation:**

- **S** (Small): < 2 hours
- **M** (Medium): 2-8 hours
- **L** (Large): 1-3 days
- **XL** (Extra Large): > 3 days

---

## ‚úÖ Completed (ƒê√£ ho√†n th√†nh)

_L∆∞u l·∫°i ƒë·ªÉ th·∫•y m√¨nh ƒë√£ l√†m ƒë∆∞·ª£c nh·ªØng g√¨._

- [x] Thi·∫øt l·∫≠p c·∫•u tr√∫c folder chu·∫©n (Services, Contexts, Pages)
- [x] X√¢y d·ª±ng `MetadataContext` ƒë·ªÉ load d·ªØ li·ªáu n·ªÅn t·∫£ng
- [x] X·ª≠ l√Ω CORS ph√≠a Backend Express
- [x] Implement Top Compositions data fetching + metadata merge
- [x] Implement Units Stats data fetching + tier grouping
- [x] Implement Items Stats data fetching + dual metadata merge (item + unit)
- [x] Implement Traits Stats data fetching + refactor SVG icons ‚Üí dynamic images

---

## üî¥ Critical (Must Fix This Sprint)

_Priority P0 - ·∫¢nh h∆∞·ªüng nghi√™m tr·ªçng ƒë·∫øn functionality ho·∫∑c data accuracy._

### **Top Compositions Page**

- [ ] **[P0 | M] Fix TopCompCard icons hi·ªÉn th·ªã sai**

  - **Issue:** Icons ƒëang fix l√† "Phi Th∆∞·ªùng" thay v√¨ dynamic theo data
  - **Impact:** Misleading visual, users kh√¥ng ph√¢n bi·ªát ƒë∆∞·ª£c comp tier
  - **Solution:** Bind icon component theo `comp.tier` ho·∫∑c `comp.icon` field
  - **Acceptance Criteria:**
    - AC1: S-Tier comps ‚Üí gold/legendary icon
    - AC2: A-Tier comps ‚Üí silver icon
    - AC3: B-Tier comps ‚Üí bronze icon
  - **Files:** `src/frontend/src/components/TeamCompCard.tsx`

- [ ] **[P0 | S] Round stats to 2 decimal places**
  - **Issue:** Stats hi·ªÉn th·ªã qu√° nhi·ªÅu ch·ªØ s·ªë (VD: `4.427583...`)
  - **Impact:** UI messy, kh√≥ ƒë·ªçc
  - **Solution:** Apply `.toFixed(2)` cho `playRate`, `avgPlace`, `top4Rate`, `winRate`
  - **Files:** `src/frontend/src/pages/TeamCompositions.tsx` (merge logic)

### **Items Page**

- [ ] **[P0 | M] Fix layout v·ª°: C·ªôt Item tr√†n sang c·ªôt Play Rate**
  - **Issue:** Text d√†i (item name) kh√¥ng wrap ‚Üí overflow
  - **Impact:** UI broken, kh√¥ng ƒë·ªçc ƒë∆∞·ª£c data
  - **Solution:**
    - Add `text-overflow: ellipsis` + `overflow: hidden`
    - Ho·∫∑c tham kh·∫£o `TraitsTable` layout structure
  - **Files:** `src/frontend/src/components/ItemsTable.tsx`

### **Data Bugs**

- [ ] **[P0 | M] Investigate Play Rate "/8" anomaly**

  - **Issue:** Play Rate c·∫ßn hi·ªÉn th·ªã format (VD: `5.09 / 8`)
  - **Questions to answer:**
    - "/8" nghƒ©a l√† g√¨? (8 players? 8 games?)
    - Backend t√≠nh sai hay frontend format sai?
  - **Solution:** Research backend calculation ‚Üí Fix format ho·∫∑c update calculation
  - **Dependencies:** Backend team clarification
  - **Files:** `src/backend/src/repositories/stats.repository.ts`

- [ ] **[P0 | S] Ensure case-insensitive ID matching in Backend repositories**
  - **Issue:** Frontend ƒë√£ lowercase IDs, nh∆∞ng backend c√≥ th·ªÉ ch∆∞a ƒë·ªìng b·ªô
  - **Impact:** Metadata merge failures, missing images
  - **Solution:** Add `.toLowerCase()` in ALL backend SQL queries khi join v·ªõi static tables
  - **Files:** `src/backend/src/repositories/stats.repository.ts`

---

## üü° High Priority (Next Sprint)

_Priority P1 - Quan tr·ªçng cho UX, n√™n l√†m s·ªõm._

### **Top Compositions Page**

- [ ] **[P1 | M] Core/Flex divider flexible theo data**

  - **Issue:** ƒêang hardcode 4 core - 4 flex
  - **Solution:** Dynamic divider based on `comp.coreUnits.length`
  - **Acceptance Criteria:**
    - AC1: 5 core units ‚Üí render 5-3 divider
    - AC2: 3 core units ‚Üí render 3-5 divider
    - AC3: Divider width t·ª± ƒë·ªông adjust
  - **Effort:** Medium (c·∫ßn refactor FlexibleDivider component)
  - **Files:** `src/frontend/src/components/TeamCompCard.tsx`

- [ ] **[P1 | M] Sort units theo gi√° v√†ng trong m·ªói comp**

  - **Issue:** Core/Flex units hi·ªÉn th·ªã random order
  - **Solution:** Sort `coreUnits` v√† `flexUnits` by `unit.cost` descending
  - **Files:** `src/frontend/src/pages/TeamCompositions.tsx` (trong merge logic)

- [ ] **[P1 | L] Implement sortable Stats columns**
  - **Feature:** Click column header ƒë·ªÉ sort comps
  - **Columns:** Play Rate, Avg Place, Top 4%, Win%
  - **Solution:**
    - Add sort state (`sortBy`, `sortOrder`)
    - Add click handlers to headers
    - Sort enrichedComps array before render
  - **Reference:** Similar to typical table sorting libraries
  - **Files:** `src/frontend/src/pages/TeamCompositions.tsx`

### **Units Page**

- [ ] **[P1 | S] Update Tier 1 color: Brown ‚Üí Grey**

  - **Issue:** Tier 1 ƒëang d√πng brown (gi·ªëng higher tiers)
  - **Solution:**
    ```typescript
    const TIER_COLORS = {
      1: "#808080", // Grey (cost 1)
      2: "#CD7F32", // Bronze (darker)
      // ...
    };
    ```
  - **Reference:** Check tactics.tools color picker
  - **Files:** `src/frontend/src/constants/tierColors.ts` (to create)

- [ ] **[P1 | S] Darken Tier 2-5 colors**
  - **Solution:** Use color picker ‚Üí copy from tactics.tools
  - **Files:** Same as above

### **Items Page**

- [ ] **[P1 | M] Add sortable columns (Play Rate, Place, Top 4, Win)**

  - **Feature:** Click header ƒë·ªÉ sort items
  - **Solution:** Similar to Top Comps sorting
  - **Files:** `src/frontend/src/pages/Items.tsx` + `ItemsTable.tsx`

- [ ] **[P1 | M] Add search by item name**

  - **Feature:** Input field ƒë·ªÉ filter items by name
  - **Solution:**
    - Add search state
    - Filter enrichedItems: `items.filter(i => i.name.includes(search))`
  - **Files:** `src/frontend/src/pages/Items.tsx`

- [ ] **[P1 | L | Backend] Add Item Type to database + API**
  - **Issue:** Thi·∫øu field `item_type` (weapon, armor, support, etc.)
  - **Dependencies:** Backend schema change + migration
  - **Backend Tasks:**
    - Update `static_items` table: add `type` column
    - Populate data from game files
    - Expose in `/metadata` endpoint
  - **Frontend Task (blocked):**
    - Add filter/sort by item type UI
  - **Files:**
    - Backend: `db.sql`, `metadata.repository.ts`
    - Frontend: `src/frontend/src/pages/Items.tsx`

### **All Pages**

- [ ] **[P1 | L | Backend] Add patch filter support**
  - **Feature:** Dropdown ƒë·ªÉ select patch version
  - **Dependencies:**
    - Backend: Add `patch` parameter to all `/stats/*` endpoints
    - Backend: Store historical patch data in DB
  - **Frontend:** Add patch selector UI component
  - **Files:** Multiple (backend + all stats pages)

---

## üü¢ Improvements (Backlog)

_Priority P2-P3 - Nice to have, polish items._

### **Top Compositions Page**

- [ ] **[P2 | S] Improve card spacing + alternating colors**

  - **Issue:** Cards c√°ch nhau xa, m√†u monotone
  - **Solution:**
    - Reduce gap gi·ªØa cards
    - Alternating bg colors (e.g., even: darker, odd: lighter)
  - **Files:** `src/frontend/src/pages/TeamCompositions.tsx`

- [ ] **[P3 | S] Remove 2 toggle switches**

  - **Issue:** Toggles kh√¥ng r√µ ch·ª©c nƒÉng, clutter UI
  - **Solution:** Delete toggle components
  - **Files:** `src/frontend/src/components/FilterSection.tsx`

- [ ] **[P3 | S] Remove icon ch·∫•m thang b√™n "Team Compositions"**
  - **Issue:** Icon n√†y kh√¥ng c√≥ √Ω nghƒ©a
  - **Solution:** Remove from header
  - **Files:** `src/frontend/src/components/FilterSection.tsx`

### **Units Page**

- [ ] **[P2 | S] Remove "Tier 1, Tier 2, ..." labels**
  - **Issue:** Redundant text, tier number v·∫´n hi·ªÉn th·ªã ·ªü component
  - **Solution:** Remove text labels, gi·ªØ visual tier indicators
  - **Files:** `src/frontend/src/components/TierSection.tsx`

### **Traits Page**

- [ ] **[P3 | S] Fix Win column width (qu√° to)**
  - **Issue:** Last column unnecessarily wide
  - **Solution:** Adjust column width in TraitsTable
  - **Files:** `src/frontend/src/components/TraitsTable.tsx`

---

## üîµ Epics / Features (Future)

_Large features c·∫ßn breakdown th√†nh sub-tasks._

### **Epic: Advanced Filtering System**

- [ ] **Filter Top Comps by Champion**

  - Description: Checkbox/multi-select ƒë·ªÉ filter comps c√≥ ch·ª©a champion X
  - Effort: M
  - Sub-tasks:
    - [ ] UI: Th√™m champion selector
    - [ ] Logic: Filter comps d·ª±a tr√™n `coreUnits` + `flexUnits`
    - [ ] UX: Show count of filtered results

- [ ] **Filter by Trait/Origin**

  - Description: Filter comps theo trait system (VD: ch·ªâ hi·ªÉn th·ªã b√†i "N·ªïi Lo·∫°n")
  - Effort: M
  - Dependencies: Trait data trong comp metadata

- [ ] **Filter by Item Type**
  - Description: Filter items page by weapon/armor/support
  - Effort: M
  - Dependencies: Item Type backend feature (see P1 section)

### **Epic: Search System**

- [ ] **Global Spotlight Search**
  - Description: Cmd+K style search for units/items/traits
  - Effort: L
  - Technologies: Fuse.js for fuzzy matching
  - Sub-tasks:
    - [ ] Build search modal component
    - [ ] Implement fuzzy search logic
    - [ ] Keyboard shortcuts (Cmd+K / Ctrl+K)
    - [ ] Search result navigation

### **Epic: Team Builder**

- [ ] **Drag & Drop Board**
  - Description: K√©o th·∫£ t∆∞·ªõng v√†o hexagonal board
  - Effort: XL
  - Technologies: react-dnd or dnd-kit
  - Sub-tasks:
    - [ ] Design hex grid layout
    - [ ] Implement drag & drop logic
    - [ ] Show team synergies (traits activated)
    - [ ] Save/share team compositions

### **Epic: Mobile Responsive**

- [ ] **Responsive Top Comps Table**

  - Description: Optimize table layout for mobile screens
  - Effort: M
  - Solution: Stack units vertically on mobile

- [ ] **Responsive Navigation**
  - Description: Hamburger menu for mobile
  - Effort: S

---

## üü° Technical Debt

_Code ch·∫°y ƒë∆∞·ª£c nh∆∞ng c·∫ßn refactor ƒë·ªÉ maintainable._

### **High Priority Debt**

- [ ] **[TD-P1 | M] Setup Constants file cho Tier Colors**

  - **Issue:** Colors ƒëang hardcoded trong components
  - **Solution:**
    ```typescript
    // src/frontend/src/constants/tierColors.ts
    export const TIER_COLORS = {
      1: "#808080",
      2: "#B8860B",
      // ...
    };
    ```
  - **Impact:** Easy to maintain, consistent colors across app
  - **Files to refactor:** `UnitCard.tsx`, `TierSection.tsx`

- [ ] **[TD-P1 | S] Move hardcoded URLs to .env**
  - **Issue:** `http://localhost:3000` hardcoded in services
  - **Solution:** Use `VITE_API_BASE_URL` consistently
  - **Files:** All `*.service.ts` files

### **Medium Priority Debt**

- [ ] **[TD-P2 | L] Cleanup unused Figma assets**

  - **Issue:** Old image imports kh√¥ng d√πng n·ªØa
  - **Solution:**
    - Audit: `grep -r "import.*assets" src/` ‚Üí find unused
    - Delete unused files
  - **Impact:** Reduce bundle size
  - **Effort:** Large (manual audit required)

- [ ] **[TD-P2 | M] Upgrade to React Query (TanStack Query)**

  - **Issue:** Manual `useEffect` fetchdata ‚Üí no caching, stale data issues
  - **Benefits:**
    - Auto caching
    - Auto refetch on window focus
    - Loading/error states built-in
  - **Migration plan:**
    - Install `@tanstack/react-query`
    - Replace `fetchTopComps` useEffect ‚Üí `useQuery`
    - Wrap app with `QueryClientProvider`
  - **Effort:** Medium (ph·∫£i migrate t·ª´ng page)

- [ ] **[TD-P2 | M] Extract data merge logic to custom hooks**
  - **Issue:** Pages c√≥ qu√° nhi·ªÅu merge logic (50+ lines)
  - **Solution:**
    ```typescript
    // hooks/useEnrichedComps.ts
    export function useEnrichedComps() {
      const { data: metadata } = useMetadata();
      const [comps, setComps] = useState([]);
      // ... merge logic here
      return enrichedComps;
    }
    ```
  - **Files:** Create hooks for each page

### **Low Priority Debt**

- [ ] **[TD-P3 | M] Add React.memo to heavy components**

  - **Issue:** UnitCard, TeamCompCard re-render unnecessarily
  - **Solution:** Wrap with `React.memo`
  - **Files:** `UnitCard.tsx`, `TeamCompCard.tsx`, `ItemRow.tsx`

- [ ] **[TD-P3 | L] Add TypeScript strict mode**

  - **Issue:** Some loose typing (`any`, missing props types)
  - **Solution:** Enable `strict: true` in `tsconfig.json` ‚Üí fix errors
  - **Effort:** Large (many files to fix)

- [ ] **[TD-P3 | L] Add error boundaries**
  - **Issue:** Kh√¥ng c√≥ error handling cho component crashes
  - **Solution:** Wrap pages with `ErrorBoundary` component
  - **Impact:** Better error UX, app kh√¥ng crash tr·∫Øng trang
